---
title: "Course overview"
subtitle: "Analysis of Ecological and Environmental Data<br>QERM 514"
author: "Mark Scheuerell"
date: "30 March 2020"
output:
  ioslides_presentation:
    css: lecture_slides.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## {.flexbox .vcenter .bigger}

<font size="10">
Who am I? 
</font>


## {.flexbox .vcenter .bigger}

<font size="10">
Who are you? 
</font>


## {.flexbox .vcenter .bigger}

<font size="10">
What is this course about? 
</font>


## Two major goals in ecology:

<font size="6">
1. Infer process from pattern   
</font>

<font size="6">
2. Make predictions
</font>


## {.flexbox .vcenter}

<font size="10">
Pattern $\overset{?}{\Rightarrow}$ Process
</font>


## {.flexbox .vcenter}

<font size="10">
Data $\overset{?}{\Rightarrow}$ Process
</font>


## {.flexbox .vcenter}

<font size="10">
Data = Process + Noise
</font>


## Ecological data often have lots of noise

```{r info_noise_barchart}
dat <- matrix(c(20, 80, 90, 10), 2, 2)
par(mai = c(0.5, 1, 0.5, 0.5))
bp <- barplot(dat, las = 1, col = c("blue", "gray"), border = NA, axes = FALSE,
        ylab = "", names.arg = c("Ecology", "Finance"), cex.names = 1.7)
text(0.7, 10, adj = c(0.5, 0.5), "Process", col = "white", cex = 1.5)
text(0.7, 60, adj = c(0.5, 0.5), "Noise", col = "black", cex = 1.5)
text(1.9, 45, adj = c(0.5, 0.5), "Process", col = "white", cex = 1.5)
text(1.9, 95, adj = c(0.5, 0.5), "Noise", col = "black", cex = 1.5)
```

## {.flexbox .vcenter}

<font size="10">
Our challenge is to separate the signal from the noise 
</font>


## General approach

### Question $\rightarrow$ Data $\rightarrow$ Model $\rightarrow$ Inference $\rightarrow$ Prediction


## General approach

### <u>Question</u> $\rightarrow$ Data $\rightarrow$ Model $\rightarrow$ Inference $\rightarrow$ Prediction


## Common questions in ecology

### Reproduction?

### Growth? 

### Survival?

### Movement?


## General approach

### Question $\rightarrow$ <u>Data</u> $\rightarrow$ Model $\rightarrow$ Inference $\rightarrow$ Prediction


## Ecological data

### Counts $\rightarrow$ density/biomass

### Measurements $\rightarrow$ size/growth

### Resights $\rightarrow$ survival/movement


## General approach

### Question $\rightarrow$ Data $\rightarrow$ <u>Model</u> $\rightarrow$ Inference $\rightarrow$ Prediction


## A simple starting point

### Data = (Deterministic part) + (Stochastic part)


## Two questions to ask:

1. What is the distributional form of the random processes?

```{r error_dist_ex, fig.height = 4, fig.width = 7, fig.align = 'center'}
par(mfrow = c(1, 2), mai = c(0.5, 0.5, 0.5, 0.1), omi = rep(0, 4), bg = NA)

hist(rnorm(1e5), breaks = 50,
     yaxt = "n", xlab = expression(epsilon), main = "Normal")

hist(rnbinom(1e5, 5, 0.3), breaks = 50,
     yaxt = "n", xlab = expression(epsilon), main = "Negative binomial")
```


## Two questions to ask:

1. What is the distributional form of the random processes?

2. How many random processes are there?

$$
\text{abundance} = f(\text{species}, \text{population}, \text{time}) \\
$$


## Forms of linear models

| Errors | Single random process | Multiple random processes |
|:-------|:--------------:|:------------------:|
| Normal | Linear Model (LM) | Linear Mixed Model (LMM) |
| Non-normal | Generalized Linear Model (GLM) | Generalized Linear Mixed Model (GLMM) |


## Forms of linear models
 
```{r model_diagram, fig.height = 5, fig.width = 7, fig.align = 'center'}
par(mai = rep(0, 4), omi = rep(0, 4), bg = NA)

## order: GLM, LM, GLMM, LMM
xx <- c(1, 2, 2, 3) * 10
yy <- c(2, 1, 3, 2) * 10

plot(c(7, 33), c(7, 33), type = "n", xlim = c(7, 33), ylim = c(7, 33),
     xaxt = "n", yaxt = "n", xlab = "", ylab = "",
     bty = "n")
symbols(xx, yy, circle = rep(2, 4), inches = 0.5, add = TRUE,
        lwd = 2, bg = "white")
text(xx, yy, c("GLM", "LM", "GLMM", "LMM"), cex = 1.5)
## from LM to GLM
arrows(xx[2]-2, yy[2]+2, xx[1]+2, yy[1]-2, length = 0.2)
text(15, 14, "multiple forms of errors", pos = 2)
## from LM to LMM
arrows(xx[2]+2, yy[2]+2, xx[4]-2, yy[4]-2, length = 0.2)
text(25, 14, "multiple random processes", pos = 4)
## from GLM to GLMM
arrows(xx[1]+2, yy[1]+2, xx[3]-2, yy[3]-2, length = 0.2)
text(15, 26, "multiple random processes", pos = 2)
## from LMM to GLMM
arrows(xx[4]-2, yy[4]+2, xx[3]+2, yy[3]-2, length = 0.2)
text(25, 26, "multiple forms of errors", pos = 4)
```


## Forms of linear models
 
```{r model_diagram_lm, fig.height = 5, fig.width = 7, fig.align = 'center'}
par(mai = rep(0, 4), omi = rep(0, 4), bg = NA)

## order: GLM, LM, GLMM, LMM
xx <- c(1, 2, 2, 3) * 10
yy <- c(2, 1, 3, 2) * 10

plot(c(7, 33), c(7, 33), type = "n", xlim = c(7, 33), ylim = c(7, 33),
     xaxt = "n", yaxt = "n", xlab = "", ylab = "",
     bty = "n")
symbols(xx, yy, circle = rep(2, 4), inches = 0.5, add = TRUE,
        lwd = 2, fg = c("black", "blue", "black", "black"), bg = "white")
text(xx, yy, c("GLM", "LM", "GLMM", "LMM"), cex = 1.5,
     col = c("black", "blue", "black", "black"))
## from LM to GLM
arrows(xx[2]-2, yy[2]+2, xx[1]+2, yy[1]-2, length = 0.2)
text(15, 14, "multiple forms of errors", pos = 2)
## from LM to LMM
arrows(xx[2]+2, yy[2]+2, xx[4]-2, yy[4]-2, length = 0.2)
text(25, 14, "multiple random processes", pos = 4)
## from GLM to GLMM
arrows(xx[1]+2, yy[1]+2, xx[3]-2, yy[3]-2, length = 0.2)
text(15, 26, "multiple random processes", pos = 2)
## from LMM to GLMM
arrows(xx[4]-2, yy[4]+2, xx[3]+2, yy[3]-2, length = 0.2)
text(25, 26, "multiple forms of errors", pos = 4)
```


## Linear models for size of fish

| Model | Description |
|:------|:-----------:|
| $\text{size}_i = \alpha + \beta \text{species}_i + \epsilon_i$ | 1-way ANOVA |
| $\text{size}_i = \alpha + \beta \text{species}_i + \beta_2 \text{site}_i + \epsilon_i$ | 2-way ANOVA |
| $\text{size}_i = \alpha + \beta \text{age}_i + \epsilon_i$ | simple linear regression |
| $\text{size}_i = \alpha + \beta \text{age}_i + \beta_2 \text{temperature}_i + \epsilon_i ~ ~$ | multiple regression |


## Forms of linear models
 
```{r model_diagram_glm, fig.height = 5, fig.width = 7, fig.align = 'center'}
par(mai = rep(0, 4), omi = rep(0, 4), bg = NA)

## order: GLM, LM, GLMM, LMM
xx <- c(1, 2, 2, 3) * 10
yy <- c(2, 1, 3, 2) * 10

plot(c(7, 33), c(7, 33), type = "n", xlim = c(7, 33), ylim = c(7, 33),
     xaxt = "n", yaxt = "n", xlab = "", ylab = "",
     bty = "n")
symbols(xx, yy, circle = rep(2, 4), inches = 0.5, add = TRUE,
        lwd = 2, fg = c("blue", "black", "black", "black"), bg = "white")
text(xx, yy, c("GLM", "LM", "GLMM", "LMM"), cex = 1.5,
     col = c("blue", "black", "black", "black"))
## from LM to GLM
arrows(xx[2]-2, yy[2]+2, xx[1]+2, yy[1]-2, length = 0.2)
text(15, 14, "multiple forms of errors", pos = 2)
## from LM to LMM
arrows(xx[2]+2, yy[2]+2, xx[4]-2, yy[4]-2, length = 0.2)
text(25, 14, "multiple random processes", pos = 4)
## from GLM to GLMM
arrows(xx[1]+2, yy[1]+2, xx[3]-2, yy[3]-2, length = 0.2)
text(15, 26, "multiple random processes", pos = 2)
## from LMM to GLMM
arrows(xx[4]-2, yy[4]+2, xx[3]+2, yy[3]-2, length = 0.2)
text(25, 26, "multiple forms of errors", pos = 4)
```


## General linear models (GLMs)

*Three important components*

1. Distribution of the data

2. Link function

3. Linear model


## Example of a GLM

Counts of trees per unit area $y_i$

$$
\begin{aligned}
\text{data distribution:} & ~~~ y_i \sim \text{Poisson}(\lambda_i) \\ \\
\text{link function:} & ~~~ \text{log}(\lambda_i) = \mu_i \\ \\
\text{linear model:} & ~~~ \mu_i = \alpha + \beta x_i
\end{aligned}
$$


## Example of a GLM

Survival of fish from eggs to adulthood $s_i$

$$
\begin{aligned}
\text{data distribution:} & ~~~ y_i \sim \text{Binomial}(N_i, s_i) \\ \\
\text{link function:} & ~~~ \text{logit}(s_i) = \text{log}\left(\frac{s_i}{1-s_i}\right) = \mu_i \\ \\
\text{linear model:} & ~~~ \mu_i = \alpha + \beta x_i
\end{aligned}
$$


## Writing an LM as a GLM

$$
y_i = \alpha + \beta x_i + \epsilon_i ~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma)
$$


## Writing an LM as a GLM

$$
y_i = \alpha + \beta x_i + \epsilon_i ~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma) \\
\Downarrow \\
y_i = \mu_i + \epsilon_i~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma) \\
\mu_i = \alpha + \beta x_i
$$


## Writing an LM as a GLM

$$
y_i = \alpha + \beta x_i + \epsilon_i ~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma) \\
\Downarrow \\
y_i = \mu_i + \epsilon_i~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma) \\
\mu_i = \alpha + \beta x_i \\
\Downarrow \\
y_i = \epsilon_i ~ \text{with} ~  \epsilon_i \sim \text{N}(\mu,\sigma) \\
\mu_i = \alpha + \beta x_i
$$


## Writing an LM as a GLM

$$
y_i = \alpha + \beta x_i + \epsilon_i ~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma) \\
\Downarrow \\
y_i = \mu_i + \epsilon_i~ \text{with} ~ \epsilon_i \sim \text{N}(0,\sigma) \\
\mu_i = \alpha + \beta x_i \\
\Downarrow \\
y_i = \epsilon_i ~ \text{with} ~  \epsilon_i \sim \text{N}(\mu,\sigma) \\
\mu_i = \alpha + \beta x_i \\
\Downarrow \\
y_i \sim \text{N}(\mu_i,\sigma) \\
1(\mu_i) = \mu_i \\
\mu_i = \alpha + \beta x_i
$$


## Forms of linear models
 
```{r model_diagram_lmm, fig.height = 5, fig.width = 7, fig.align = 'center'}
par(mai = rep(0, 4), omi = rep(0, 4), bg = NA)

## order: GLM, LM, GLMM, LMM
xx <- c(1, 2, 2, 3) * 10
yy <- c(2, 1, 3, 2) * 10

plot(c(7, 33), c(7, 33), type = "n", xlim = c(7, 33), ylim = c(7, 33),
     xaxt = "n", yaxt = "n", xlab = "", ylab = "",
     bty = "n")
symbols(xx, yy, circle = rep(2, 4), inches = 0.5, add = TRUE,
        lwd = 2, fg = c("black", "black", "black", "blue"), bg = "white")
text(xx, yy, c("GLM", "LM", "GLMM", "LMM"), cex = 1.5,
     col = c("black", "black", "black", "blue"))
## from LM to GLM
arrows(xx[2]-2, yy[2]+2, xx[1]+2, yy[1]-2, length = 0.2)
text(15, 14, "multiple forms of errors", pos = 2)
## from LM to LMM
arrows(xx[2]+2, yy[2]+2, xx[4]-2, yy[4]-2, length = 0.2)
text(25, 14, "multiple random processes", pos = 4)
## from GLM to GLMM
arrows(xx[1]+2, yy[1]+2, xx[3]-2, yy[3]-2, length = 0.2)
text(15, 26, "multiple random processes", pos = 2)
## from LMM to GLMM
arrows(xx[4]-2, yy[4]+2, xx[3]+2, yy[3]-2, length = 0.2)
text(25, 26, "multiple forms of errors", pos = 4)
```


## Why use linear mixed models?

* Ecological data are often messy, complex, and incomplete

* Data are often grouped by location, species, etc

* May have multiple samples from the same individual

* Often small sample sizes for some locations, species, etc


## Some terminology

**fixed factor** = *qualitative* predictor (e.g. sex)

**fixed effect** = *quantitative* change ("slope")

**random factor** = *qualitative* predictor whose levels are randomly
sampled from a population (eg, age)

**random effect** = *quantitative* change whose levels are randomly
sampled from a population


## A linear model (ANCOVA)

Fish mass as a function of its length and *specific* location

$$
y_{i,j} = \underbrace{\alpha + \beta x_{i,j} + \delta_{j}}_{\text{fixed}} + \underbrace{\epsilon_{i,j}}_{\text{random}} 
$$

$y_i$ is the log(mass) for fish *i* in location $j$

$x_i$ is the log(length) for fish *i* in location $j$

$\delta_j$ is the mean log(mass) of fish in location $j$

$\epsilon_{i,j} \sim \text{N}(0,\sigma_\epsilon)$


## A linear mixed model

Fish mass as a function of its length and *general* location

$$
y_{i,j} = \underbrace{\alpha + \beta x_{i,j}}_{\text{fixed}} + \underbrace{\delta_{j} + \epsilon_{i,j}}_{\text{random}} 
$$

$y_i$ is the log(mass) for fish *i* in location $j$

$x_i$ is the log(length) for fish *i* in location $j$

$\delta_j$ is the mean log(mass) of fish in location $j$

$\epsilon_{i,j} \sim \text{N}(0,\sigma_\epsilon) ~ \text{and} ~ \delta_{j} \sim \text{N}(0,\sigma_\delta)$


## Forms of linear models
 
```{r model_diagram_glmm, fig.height = 5, fig.width = 7, fig.align = 'center'}
par(mai = rep(0, 4), omi = rep(0, 4), bg = NA)

## order: GLM, LM, GLMM, LMM
xx <- c(1, 2, 2, 3) * 10
yy <- c(2, 1, 3, 2) * 10

plot(c(7, 33), c(7, 33), type = "n", xlim = c(7, 33), ylim = c(7, 33),
     xaxt = "n", yaxt = "n", xlab = "", ylab = "",
     bty = "n")
symbols(xx, yy, circle = rep(2, 4), inches = 0.5, add = TRUE,
        lwd = 2, fg = c("black", "black", "blue", "black"), bg = "white")
text(xx, yy, c("GLM", "LM", "GLMM", "LMM"), cex = 1.5,
     col = c("black", "black", "blue", "black"))
## from LM to GLM
arrows(xx[2]-2, yy[2]+2, xx[1]+2, yy[1]-2, length = 0.2)
text(15, 14, "multiple forms of errors", pos = 2)
## from LM to LMM
arrows(xx[2]+2, yy[2]+2, xx[4]-2, yy[4]-2, length = 0.2)
text(25, 14, "multiple random processes", pos = 4)
## from GLM to GLMM
arrows(xx[1]+2, yy[1]+2, xx[3]-2, yy[3]-2, length = 0.2)
text(15, 26, "multiple random processes", pos = 2)
## from LMM to GLMM
arrows(xx[4]-2, yy[4]+2, xx[3]+2, yy[3]-2, length = 0.2)
text(25, 26, "multiple forms of errors", pos = 4)
```


## General linear mixed model

Survival of fish $s_{i,j}$ as a function of length $x_{i,j}$ in location $j$

$$
\begin{aligned}
\text{data distribution:} & ~~~ y_{i,j} \sim \text{Binomial}(N_{i,j}, s_{i,j}) \\ \\
\text{link function:} & ~~~ \text{logit}(s_{i,j}) = \text{log}\left(\frac{s_{i,j}}{1-s_{i,j}}\right) = \mu_{i,j} \\ \\
\text{linear model:} & ~~~ \mu_{i,j} = \alpha + \underline{\beta_j} x_{i,j} \\
& ~~~ \beta_j \sim \text{N}(0, \sigma)
\end{aligned}
$$



## Linear models for size of fish

[R code for simple models]


## General approach

### Question $\rightarrow$ Data $\rightarrow$ Model $\rightarrow$ <u>Inference</u> $\rightarrow$ Prediction


## Linear models for size of fish

[choose *best* model]


## General approach

### Question $\rightarrow$ Data $\rightarrow$ Model $\rightarrow$ Inference $\rightarrow$ <u>Prediction</u>


## Linear models for size of fish

[R code for prediction]


## Learning objectives

By the end of the quarter, students should be able to:

* Identify an appropriate statistical model based on the data and specific question

* Understand the assumptions behind a chosen statistical model

* Use **R** to fit GLMs and GLMMs to data

* Evaluate data support for various models and select the most parsimonious model among them

* Use **R Markdown** to combine text, equations, code, tables, and figures into reports


## Grading {.smaller}

* __Weekly homework__ (70% of total)
    - Assigned Friday at the end of computer lab
    - Due by 11:59 PM the following Friday

* __Final project__ (30% of total)
    - Analysis
    - Presentation (last week of class)
    - Report (due by 11:59 PM PST on June 7)


## {.flexbox .vcenter .bigger}

<font size="10">
[__Course website__](https://qerm514.github.io/website)
</font>

